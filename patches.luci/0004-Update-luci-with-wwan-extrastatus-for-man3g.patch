From c05f57e52e1659fa0a894782f0f52157bc255585 Mon Sep 17 00:00:00 2001
From: syoder <syoder@imagestream.com>
Date: Thu, 15 Aug 2013 18:06:16 -0500
Subject: [PATCH 04/14] Update luci with wwan "extrastatus" for man3g

---
 .../luci-app-multiwan/luasrc/model/cbi/multiwan/multiwan.lua          | 1 +
 imagestream/openwrt-luci/libs/core/luasrc/model/network.lua       | 8 ++++++++
 .../modules/luci-mod-admin-full/luasrc/controller/admin/network.lua        | 1 +
 .../modules/luci-mod-admin-full/luasrc/view/admin_network/iface_status.htm | 5 +++++
 4 files changed, 15 insertions(+)

--- a/applications/luci-app-multiwan/luasrc/model/cbi/multiwan/multiwan.lua
+++ b/applications/luci-app-multiwan/luasrc/model/cbi/multiwan/multiwan.lua
@@ -52,6 +52,7 @@ interval.rmempty = false
 
 icmp_hosts = s:option(Value, "icmp_hosts", translate("Health Monitor ICMP Host(s)"))
 icmp_hosts:value("disable", translate("Disable"))
+icmp_hosts:value("arp_gateway", "WAN Gateway using ARP")
 icmp_hosts:value("dns", "DNS Server(s)")
 icmp_hosts:value("gateway", "WAN Gateway")
 icmp_hosts.default = "dns"
--- a/modules/luci-base/luasrc/model/network.lua
+++ b/modules/luci-base/luasrc/model/network.lua
@@ -1137,6 +1137,14 @@ function protocol.adminlink(self)
 	return dsp.build_url("admin", "network", "network", self.sid)
 end
 
+function protocol.extrastatus(self)
+	local p = self:proto()
+	if p == "ndis" then
+		return utl.exec("man3g -i %s status" % self:name())
+	end
+	return 0
+end
+
 
 interface = utl.class()
 
--- a/modules/luci-mod-admin-full/luasrc/controller/admin/network.lua
+++ b/modules/luci-mod-admin-full/luasrc/controller/admin/network.lua
@@ -248,6 +248,7 @@ function iface_status(ifaces)
 				tx_bytes   = device:tx_bytes(),
 				rx_packets = device:rx_packets(),
 				tx_packets = device:tx_packets(),
+				extrastatus = net:extrastatus(),
 
 				subdevices = { }
 			}
--- a/modules/luci-mod-admin-full/luasrc/view/admin_network/iface_status.htm
+++ b/modules/luci-mod-admin-full/luasrc/view/admin_network/iface_status.htm
@@ -60,6 +60,11 @@
 						html += String.format('<strong><%:IPv6-PD%>:</strong> %s<br />', ifc.ip6prefix);
 					}
 
+					if (ifc.extrastatus)
+					{
+						html += String.format('<br /><pre style=" width: 420px;">%s</pre></div>', ifc.extrastatus);
+					}
+
 					d.innerHTML = html;
 				}
 				else if (d)
