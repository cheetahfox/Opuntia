From 1837fb7f2f36df4b79bd7329ee03ba1c43d6171c Mon Sep 17 00:00:00 2001
From: syoder <syoder@imagestream.com>
Date: Thu, 5 Sep 2013 12:33:45 -0500
Subject: [PATCH 06/14] Add license info to overview page. Change distro name
 to Opuntia

---
 .../modules/luci-mod-admin-full/luasrc/view/admin_status/index.htm           | 6 ++++++
 1 file changed, 6 insertions(+)

--- a/modules/luci-mod-admin-full/luasrc/view/admin_status/index.htm
+++ b/modules/luci-mod-admin-full/luasrc/view/admin_status/index.htm
@@ -557,11 +557,13 @@
 
 	<table width="100%" cellspacing="10">
 		<tr><td width="33%"><%:Hostname%></td><td><%=luci.sys.hostname() or "?"%></td></tr>
-		<tr><td width="33%"><%:Model%></td><td><%=pcdata(boardinfo.model or boardinfo.system or "?")%></td></tr>
-		<tr><td width="33%"><%:Firmware Version%></td><td>
-			<%=pcdata(ver.distname)%> <%=pcdata(ver.distversion)%> /
-			<%=pcdata(ver.luciname)%> (<%=pcdata(ver.luciversion)%>)
+		<tr><td width="33%"><%:Product Information%></td><td>
+			Manufacturer:  <%=pcdata(luci.version.distmanufacturer)%><br/>
+			Product id:    <%=pcdata(luci.version.distproduct)%>, revision <%=pcdata(luci.version.disthwrev)%><br/>
 		</td></tr>
+                <tr><td width="33%"><%:Firmware Version%></td><td>
+                        <%=pcdata(luci.version.distname)%> <%=pcdata(luci.version.distversion)%> <%=luci.sys.exec("grep REVISION /etc/opuntia_release | cut -d '\"' -f 2")%>
+                </td></tr>
 		<tr><td width="33%"><%:Kernel Version%></td><td><%=unameinfo.release or "?"%></td></tr>
 		<tr><td width="33%"><%:Local Time%></td><td id="localtime">-</td></tr>
 		<tr><td width="33%"><%:Uptime%></td><td id="uptime">-</td></tr>
--- a/modules/luci-base/src/mkversion.sh
+++ b/modules/luci-base/src/mkversion.sh
@@ -31,9 +31,15 @@ module "luci.version"
 if pcall(dofile, "/etc/openwrt_release") and _G.DISTRIB_DESCRIPTION then
 	distname    = ""
 	distversion = _G.DISTRIB_DESCRIPTION
+	distproduct = _G.DISTRIB_PRODUCT
+	distmanufacturer = _G.DISTRIB_MANUFACTURER
+	disthwrev = _G.DISTRIB_HWREV
 else
 	distname    = "OpenWrt"
 	distversion = "Development Snapshot"
+	distproduct = "Unknown"
+	distmanufacturer = "ISis ImageStream Internet Solutions"
+	disthwrev = "Unknown"
 end
 
 luciname    = "$variant"
