From 8199d522e21860c8205b62c033e92f1bea23862a Mon Sep 17 00:00:00 2001
From: syoder <syoder@imagestream.com>
Date: Mon, 16 Sep 2013 12:54:27 -0500
Subject: [PATCH 09/14] Fixup display of wireless interface in mesh mode

---
 .../openwrt-luci/modules/luci-base/luasrc/model/network.lua      | 16 ++++++++++++----
 1 file changed, 12 insertions(+), 4 deletions(-)

--- a/modules/luci-base/luasrc/model/network.lua
+++ b/modules/luci-base/luasrc/model/network.lua
@@ -1390,11 +1390,15 @@ function wifinet.mode(self)
 end
 
 function wifinet.ssid(self)
-	return _uci_state:get("wireless", self.sid, "ssid")
+	return _uci_state:get("wireless", self.sid, "ssid") or _uci_state:get("wireless", self.sid, "mesh_id")
 end
 
 function wifinet.bssid(self)
-	return _uci_state:get("wireless", self.sid, "bssid")
+	return _uci_state:get("wireless", self.sid, "bssid") or _uci_state:get("wireless", self.sid, "mesh_id")
+end
+
+function wifinet.mesh_id(self)
+	return _uci_state:get("wireless", self.sid, "mesh_id")
 end
 
 function wifinet.network(self)
@@ -1446,11 +1450,15 @@ function wifinet.active_mode_i18n(self)
 end
 
 function wifinet.active_ssid(self)
-	return _stror(self.iwdata.ssid, self.iwinfo.ssid)
+	return _stror(self.iwdata.ssid, self.iwdata.ssid) or _stror(self.iwdata.mesh_id, self.iwdata.mesh_id) 
 end
 
 function wifinet.active_bssid(self)
-	return _stror(self.iwdata.bssid, self.iwinfo.bssid) or "00:00:00:00:00:00"
+	return _stror(self.iwdata.bssid, self.iwdata.bssid) or _stror(self.iwdata.mesh_id, self.iwdata.mesh_id) or "00:00:00:00:00:00"
+end
+
+function wifinet.active_mesh_id(self)
+	return _stror(self.iwdata.mesh_id, self.iwdata.mesh_id)
 end
 
 function wifinet.active_encryption(self)
