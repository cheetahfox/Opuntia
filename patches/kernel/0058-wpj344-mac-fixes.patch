Index: build_dir/target/linux/ar71xx/files/arch/mips/ath79/mach-wpj344.c
===================================================================
--- build_dir.orig/target/linux/ar71xx/files/arch/mips/ath79/mach-wpj344.c
+++ build_dir/target/linux/ar71xx/files/arch/mips/ath79/mach-wpj344.c
@@ -129,10 +129,14 @@ static struct mdio_board_info wpj344_mdi
 	},
 };
 
+u8 *ath10k_macaddr = NULL;
+EXPORT_SYMBOL_GPL(ath10k_macaddr);
+
 static void __init wpj344_setup(void)
 {
+        struct ath9k_platform_data *pdata;
+	u8 mac[ETH_ALEN];
 	u8 *art = (u8 *) KSEG1ADDR(0x1fff0000);
-	u8 *mac = (u8 *) KSEG1ADDR(0x1f02e000);
 
 	ath79_register_m25p80(NULL);
 	ath79_register_leds_gpio(-1, ARRAY_SIZE(wpj344_leds_gpio),
@@ -142,17 +146,25 @@ static void __init wpj344_setup(void)
 					wpj344_gpio_keys);
 
 	ath79_register_usb();
-
-	ath79_register_wmac(art + WPJ344_WMAC_CALDATA_OFFSET, NULL);
-
-	ath79_register_pci();
+	/* Reserve one for LAN */
+	ath79_init_mac(mac, (u8 *) KSEG1ADDR(0x1f02e000) + WPJ344_MAC0_OFFSET, 3);
+	ath79_register_wmac(art + WPJ344_WMAC_CALDATA_OFFSET, mac);
+	ath79_init_mac(mac, (u8 *) KSEG1ADDR(0x1f02e000) + WPJ344_MAC0_OFFSET, 2);
+	ath10k_macaddr = kmalloc(ETH_ALEN, GFP_KERNEL);
+	memcpy(ath10k_macaddr, mac, ETH_ALEN);
+	ap91_pci_init(NULL, mac);
+        pdata = ap9x_pci_get_wmac_data(0);
+        if (pdata) {
+        	pdata->use_eeprom = true;
+	}
 
 	mdiobus_register_board_info(wpj344_mdio0_info,
 					ARRAY_SIZE(wpj344_mdio0_info));
 
 	ath79_register_mdio(0, 0x0);
 
-	ath79_init_mac(ath79_eth0_data.mac_addr, mac + WPJ344_MAC0_OFFSET, 0);
+	ath79_init_mac(ath79_eth0_data.mac_addr, (u8 *) KSEG1ADDR(0x1f02e000) + WPJ344_MAC0_OFFSET, 0);
+	ath79_init_mac(ath79_eth1_data.mac_addr, (u8 *) KSEG1ADDR(0x1f02e000) + WPJ344_MAC0_OFFSET, 1);
 
 	ath79_setup_ar934x_eth_cfg(AR934X_ETH_CFG_RGMII_GMAC0 |
 				   AR934X_ETH_CFG_SW_ONLY_MODE);
Index: build_dir/package/kernel/mac80211/ath.mk
===================================================================
--- build_dir.orig/package/kernel/mac80211/ath.mk
+++ build_dir/package/kernel/mac80211/ath.mk
@@ -48,6 +48,8 @@ config-$(CONFIG_ATH9K_TX99) += ATH9K_TX9
 config-$(CONFIG_ATH9K_UBNTHSR) += ATH9K_UBNTHSR
 config-$(CONFIG_ATH10K_LEDS) += ATH10K_LEDS
 config-$(CONFIG_ATH10K_THERMAL) += ATH10K_THERMAL
+config-$(CONFIG_ATH10K_MAC_OVERRIDE) += ATH10K_MAC_OVERRIDE
+
 
 config-$(call config_package,ath9k-htc) += ATH9K_HTC
 config-$(call config_package,ath10k) += ATH10K ATH10K_PCI
@@ -265,6 +267,12 @@ define KernelPackage/ath10k/config
                bool "Enable thermal sensors and throttling support"
                depends on PACKAGE_kmod-ath10k
 
+       config ATH10K_MAC_OVERRIDE
+                bool "Override ath10k MAC address from board"
+                default n
+                help
+                  Override the ath10k card's MAC address with one pre-allocated by the motherboard
+
 endef
 
 define KernelPackage/carl9170
Index: build_dir/package/kernel/mac80211/patches/ath/999-scott-ath10k-set-mac-address-from-wpj344.patch
===================================================================
--- /dev/null
+++ build_dir/package/kernel/mac80211/patches/ath/999-scott-ath10k-set-mac-address-from-wpj344.patch
@@ -0,0 +1,17 @@
+Index: backports-4.19.23-1/drivers/net/wireless/ath/ath10k/mac.c
+===================================================================
+--- backports-4.19.23-1.orig/drivers/net/wireless/ath/ath10k/mac.c
++++ backports-4.19.23-1/drivers/net/wireless/ath/ath10k/mac.c
+@@ -8383,6 +8383,12 @@ int ath10k_mac_register(struct ath10k *a
+ 	void *channels;
+ 	int ret;
+ 
++	if (IS_ENABLED(CPTCFG_ATH10K_MAC_OVERRIDE)) {
++		extern u8 *ath10k_macaddr;
++		if (ath10k_macaddr)
++			memcpy(ar->mac_addr, ath10k_macaddr, ETH_ALEN);
++	}
++
+ 	SET_IEEE80211_PERM_ADDR(ar->hw, ar->mac_addr);
+ 
+ 	SET_IEEE80211_DEV(ar->hw, ar->dev);
